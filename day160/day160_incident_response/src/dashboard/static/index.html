<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Response Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .metric-label {
            color: #888;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
        }
        
        .response-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .response-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .response-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .response-item:hover {
            background: #e9ecef;
            border-left-color: #764ba2;
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .response-id {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-running {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .playbook-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .playbook-tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
        }
        
        .timestamp {
            color: #999;
            font-size: 0.9em;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .audit-log {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        
        .audit-entry {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            font-size: 0.9em;
        }
        
        .audit-entry:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        function Dashboard() {
            const [metrics, setMetrics] = useState({});
            const [responses, setResponses] = useState([]);
            const [auditLog, setAuditLog] = useState([]);
            const [incidentReports, setIncidentReports] = useState([]);
            const [slaStatus, setSlaStatus] = useState({});
            const [approvals, setApprovals] = useState([]);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                loadData();
                const interval = setInterval(loadData, 3000);
                return () => clearInterval(interval);
            }, []);
            
            const loadData = async () => {
                try {
                    const [metricsRes, responsesRes, auditRes, reportsRes, slaRes, approvalsRes] = await Promise.all([
                        fetch('/api/metrics'),
                        fetch('/api/responses?limit=10'),
                        fetch('/api/audit-log?limit=20'),
                        fetch('/api/incidents/reports?limit=10'),
                        fetch('/api/sla/status'),
                        fetch('/api/approvals')
                    ]);
                    
                    setMetrics(await metricsRes.json());
                    setResponses((await responsesRes.json()).responses);
                    setAuditLog((await auditRes.json()).audit_log);
                    setIncidentReports((await reportsRes.json()).reports || []);
                    setSlaStatus(await slaRes.json());
                    setApprovals((await approvalsRes.json()).approvals || []);
                    setLoading(false);
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            };
            
            const testBruteForce = async () => {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event_type: 'brute_force_attack',
                        severity: 'high',
                        source: '192.168.1.100',
                        details: {
                            source_ip: '192.168.1.100',
                            target_user: 'admin',
                            failed_attempts: 15
                        }
                    })
                });
                loadData();
            };
            
            const testMalware = async () => {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event_type: 'malware_detected',
                        severity: 'critical',
                        source: 'workstation-42',
                        details: {
                            system_id: 'workstation-42',
                            user_id: 'jsmith',
                            malware_type: 'ransomware'
                        }
                    })
                });
                loadData();
            };
            
            const testC2 = async () => {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event_type: 'c2_communication',
                        severity: 'critical',
                        source: 'server-05',
                        details: {
                            system_id: 'server-05',
                            c2_ip: '203.0.113.10',
                            user_id: 'system'
                        }
                    })
                });
                loadData();
            };
            
            if (loading) {
                return (
                    <div className="dashboard">
                        <div className="loading">
                            <div className="spinner"></div>
                            <p>Loading incident response dashboard...</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="dashboard">
                    <div className="header">
                        <h1>üõ°Ô∏è Incident Response Dashboard</h1>
                        <p>Automated Security Response Orchestration</p>
                    </div>
                    
                    <div className="metrics-grid">
                        <div className="metric-card">
                            <div className="metric-label">Active Playbooks</div>
                            <div className="metric-value">{metrics.active_playbooks || 0}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">Total Responses</div>
                            <div className="metric-value">{metrics.total_responses || 0}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">Audit Entries</div>
                            <div className="metric-value">{metrics.audit_entries || 0}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">Playbook Templates</div>
                            <div className="metric-value">{metrics.playbook_templates || 0}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">SLA Met</div>
                            <div className="metric-value" style={{color: slaStatus.sla_met ? '#28a745' : '#dc3545'}}>
                                {slaStatus.sla_met || 0}
                            </div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">SLA Breached</div>
                            <div className="metric-value" style={{color: '#dc3545'}}>
                                {slaStatus.sla_breached || 0}
                            </div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">Pending Approvals</div>
                            <div className="metric-value" style={{color: '#ffc107'}}>
                                {approvals.length || 0}
                            </div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-label">Incident Reports</div>
                            <div className="metric-value">{incidentReports.length || 0}</div>
                        </div>
                    </div>
                    
                    <div className="response-section">
                        <h2>üß™ Test Incident Scenarios</h2>
                        <div className="test-controls">
                            <button className="test-button" onClick={testBruteForce}>
                                Test Brute Force Attack
                            </button>
                            <button className="test-button" onClick={testMalware}>
                                Test Malware Detection
                            </button>
                            <button className="test-button" onClick={testC2}>
                                Test C2 Communication
                            </button>
                        </div>
                    </div>
                    
                    <div className="response-section">
                        <h2>üìã Recent Incident Responses</h2>
                        {responses.length === 0 ? (
                            <p style={{color: '#999'}}>No incident responses yet. Click the test buttons above to generate incidents.</p>
                        ) : (
                            responses.map((response, idx) => (
                                <div key={idx} className="response-item">
                                    <div className="response-header">
                                        <div>
                                            <div className="response-id">{response.event_type}</div>
                                            <div className="timestamp">{response.started_at}</div>
                                        </div>
                                        <span className={`status-badge status-${response.results?.[0]?.status || 'running'}`}>
                                            {response.results?.[0]?.status || 'running'}
                                        </span>
                                    </div>
                                    <div className="playbook-list">
                                        {response.playbooks.map((playbook, pidx) => (
                                            <span key={pidx} className="playbook-tag">{playbook}</span>
                                        ))}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                    
                    <div className="response-section">
                        <h2>üìú Recent Audit Log</h2>
                        <div className="audit-log">
                            {auditLog.slice(-10).reverse().map((entry, idx) => (
                                <div key={idx} className="audit-entry">
                                    <strong>{entry.action}</strong> ({entry.action_type}) - {entry.status}
                                    <br/>
                                    <span style={{color: '#999', fontSize: '0.85em'}}>{entry.timestamp}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    {approvals.length > 0 && (
                        <div className="response-section">
                            <h2>‚è≥ Pending Approvals</h2>
                            {approvals.map((approval, idx) => (
                                <div key={idx} className="response-item">
                                    <div className="response-header">
                                        <div>
                                            <div className="response-id">{approval.action_name}</div>
                                            <div className="timestamp">{approval.requested_at}</div>
                                        </div>
                                        <span className="status-badge status-running">Pending</span>
                                    </div>
                                    <div style={{marginTop: '10px', fontSize: '0.9em', color: '#666'}}>
                                        Type: {approval.action_type} | Approvers: {approval.approvers.join(', ')}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    <div className="response-section">
                        <h2>üìä Incident Reports</h2>
                        {incidentReports.length === 0 ? (
                            <p style={{color: '#999'}}>No incident reports yet. Reports are generated after incident resolution.</p>
                        ) : (
                            incidentReports.slice().reverse().map((report, idx) => (
                                <div key={idx} className="response-item">
                                    <div className="response-header">
                                        <div>
                                            <div className="response-id">{report.incident_type} - {report.incident_id}</div>
                                            <div className="timestamp">Risk Score: {report.risk_score} | Severity: {report.severity}</div>
                                        </div>
                                        <span className={`status-badge ${report.sla_status?.response_time_met ? 'status-completed' : 'status-failed'}`}>
                                            {report.sla_status?.response_time_met ? 'SLA Met' : 'SLA Breached'}
                                        </span>
                                    </div>
                                    <div style={{marginTop: '10px', fontSize: '0.9em'}}>
                                        <strong>Summary:</strong> {report.summary}
                                        <br/>
                                        <strong>Actions:</strong> {report.actions_executed} executed, {report.actions_failed} failed
                                        {report.duration_seconds && (
                                            <span> | Duration: {Math.round(report.duration_seconds)}s</span>
                                        )}
                                    </div>
                                    {report.recommendations && report.recommendations.length > 0 && (
                                        <div style={{marginTop: '10px', padding: '10px', background: '#e7f3ff', borderRadius: '5px'}}>
                                            <strong>Recommendations:</strong>
                                            <ul style={{marginTop: '5px', marginLeft: '20px'}}>
                                                {report.recommendations.map((rec, ridx) => (
                                                    <li key={ridx} style={{marginBottom: '5px'}}>{rec}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
