<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI Integration Dashboard</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" 
            onerror="console.warn('Chart.js CDN failed, using fallback'); this.onerror=null; this.src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js';"></script>
</head>
<body>
    <!-- Login Section -->
    <div id="login-section" class="hidden">
        <div class="login-form">
            <h2>BI Integration Dashboard</h2>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required value="admin">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required value="admin_secret">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: #7f8c8d; text-align: center;">
                Default: admin / admin_secret
            </p>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="hidden">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>ðŸ“Š BI Integration Dashboard</h1>
                <div class="header-controls">
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span>System Online</span>
                    </div>
                    <span class="refresh-indicator" id="last-refresh">Loading...</span>
                    <button onclick="manualRefresh()" class="btn btn-secondary">Refresh</button>
                    <button onclick="logout()" class="btn btn-danger">Logout</button>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="loading hidden">
                <div class="spinner" style="margin: 0 auto;"></div>
                <p>Loading dashboard data...</p>
            </div>

            <!-- Metric Cards -->
            <div class="dashboard-grid">
                <div class="metric-card" id="metric-requests">
                    <h3>Total Requests</h3>
                    <div class="metric-value">-</div>
                    <div class="metric-change">Loading...</div>
                </div>
                <div class="metric-card" id="metric-response-time">
                    <h3>Avg Response Time</h3>
                    <div class="metric-value">-</div>
                    <div class="metric-change">Loading...</div>
                </div>
                <div class="metric-card" id="metric-error-rate">
                    <h3>Error Rate</h3>
                    <div class="metric-value">-</div>
                    <div class="metric-change">Loading...</div>
                </div>
            </div>

            <!-- Time Series Chart -->
            <div class="chart-container">
                <h2>Request Metrics (Last 7 Days)</h2>
                <div class="chart-wrapper">
                    <canvas id="timeseries-chart"></canvas>
                </div>
            </div>

            <!-- Export Section -->
            <div class="export-section">
                <h2>Data Exports</h2>
                <p style="color: #7f8c8d; margin-bottom: 1rem;">
                    Generate scheduled exports (manual trigger for simulation)
                </p>
                <form class="export-form" onsubmit="generateExport(event)">
                    <div class="control-group">
                        <label for="export-date">Date</label>
                        <input type="date" id="export-date" name="date" required>
                    </div>
                    <div class="control-group">
                        <label for="export-format">Format</label>
                        <select id="export-format" name="format" required>
                            <option value="csv">CSV</option>
                            <option value="parquet">Parquet</option>
                        </select>
                    </div>
                    <button type="submit" id="export-btn" class="btn btn-primary">Generate Export</button>
                </form>
                <div class="export-list">
                    <h3 style="margin-top: 1.5rem; margin-bottom: 1rem; color: #2c3e50;">Recent Exports</h3>
                    <div id="export-list">
                        <p class="loading">Loading exports...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
    <script>
        // Set default export date to yesterday
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('export-date');
            if (dateInput) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                dateInput.value = yesterday.toISOString().split('T')[0];
            }
        });
    </script>
</body>
</html>

