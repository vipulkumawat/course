version: '3.8'

services:
  windows-event-agent:
    build: .
    ports:
      - "8080:8080"
      - "9090:9090"
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
    environment:
      - WINDOWS_AGENT_TRANSPORT_URL=http://mock-log-server:8081/api/v1/logs
      - WINDOWS_AGENT_LOG_LEVEL=INFO
    depends_on:
      - mock-log-server
    restart: unless-stopped

  mock-log-server:
    image: python:3.11-slim
    ports:
      - "8081:8081"
    command: >
      sh -c "pip install fastapi uvicorn && python -c 'from fastapi import FastAPI, Request; import uvicorn; import json; app = FastAPI(); @app.post(\'/api/v1/logs\')\nasync def receive_logs(request: Request): data = await request.json(); print(f\'Received {len(data.get("events", []))} events from Windows agent\'); return {\'status\': \'success\', \'received\': len(data.get(\'events\', []))}; if __name__ == \"__main__\": uvicorn.run(app, host=\"0.0.0.0\", port=8081)'"
    restart: unless-stopped

networks:
  default:
    name: windows-event-network
