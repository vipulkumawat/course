version: '3.8'

services:
  gitops-controller:
    build:
      context: .
      dockerfile: docker/Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./config:/app/config
      - ./manifests:/app/manifests
      - gitops-repo:/tmp/gitops-repo
    environment:
      - PYTHONUNBUFFERED=1
    command: python src/main.py
    
  gitops-dashboard:
    build:
      context: .
      dockerfile: docker/Dockerfile
    ports:
      - "8080:8000"
    command: python src/dashboard/app.py

volumes:
  gitops-repo:
