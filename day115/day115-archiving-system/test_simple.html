<!DOCTYPE html>
<html>
<head>
    <title>Simple Dashboard Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stat-card { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 6px; }
        .job-item { background: #e0e0e0; padding: 10px; margin: 5px 0; border-radius: 4px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .refresh-btn { background: #2563eb; color: white; }
        .trigger-btn { background: #10b981; color: white; }
    </style>
</head>
<body>
    <h1>Simple Dashboard Test</h1>
    
    <div>
        <button class="refresh-btn" onclick="refreshData()">ðŸ”„ Refresh Data</button>
        <button class="trigger-btn" onclick="triggerArchival()">ðŸ”„ Trigger Archival</button>
    </div>
    
    <div class="stat-card">
        <h3>Stats</h3>
        <div id="stats-display">Loading...</div>
    </div>
    
    <div class="stat-card">
        <h3>Recent Jobs</h3>
        <div id="jobs-display">Loading...</div>
    </div>
    
    <script>
        function refreshData() {
            console.log('Refreshing data...');
            const button = event.target;
            button.textContent = 'ðŸ”„ Refreshing...';
            button.disabled = true;
            
            Promise.all([
                fetch('http://localhost:8001/api/stats').then(r => r.json()),
                fetch('http://localhost:8001/api/jobs').then(r => r.json())
            ]).then(([stats, jobs]) => {
                console.log('Stats:', stats);
                console.log('Jobs:', jobs);
                
                // Display stats
                document.getElementById('stats-display').innerHTML = `
                    <div>Total Archived: ${stats.archival.total_archived}</div>
                    <div>Compression: ${((1 - stats.archival.compression_ratio) * 100).toFixed(1)}%</div>
                    <div>Storage Saved: ${((stats.archival.total_original_size - stats.archival.total_compressed_size) / (1024 * 1024)).toFixed(1)} MB</div>
                    <div>Cold Storage: ${stats.storage.cold.file_count} files (${stats.storage.cold.total_size_mb} MB)</div>
                `;
                
                // Display jobs
                const jobsHtml = jobs.jobs.length > 0 ? 
                    jobs.jobs.map(job => `
                        <div class="job-item">
                            <strong>Job ${job.job_id}</strong> - ${job.status.toUpperCase()}<br>
                            Entries: ${job.entries ? job.entries.length : 0} | 
                            Compression: ${((1 - job.compression_ratio) * 100).toFixed(1)}% | 
                            Tier: ${job.storage_tier || 'N/A'}<br>
                            Created: ${new Date(job.created_at).toLocaleString()}
                        </div>
                    `).join('') : 
                    '<div class="job-item">No jobs found</div>';
                
                document.getElementById('jobs-display').innerHTML = jobsHtml;
                
                button.textContent = 'âœ… Refreshed';
                setTimeout(() => {
                    button.textContent = 'ðŸ”„ Refresh Data';
                    button.disabled = false;
                }, 1000);
            }).catch(error => {
                console.error('Error:', error);
                button.textContent = 'âŒ Error';
                setTimeout(() => {
                    button.textContent = 'ðŸ”„ Refresh Data';
                    button.disabled = false;
                }, 2000);
            });
        }
        
        function triggerArchival() {
            console.log('Triggering archival...');
            const button = event.target;
            button.textContent = 'â³ Processing...';
            button.disabled = true;
            
            fetch('http://localhost:8001/api/trigger-archival', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    console.log('Archival response:', data);
                    if (data.status === 'success') {
                        button.textContent = 'âœ… Completed';
                        // Refresh data after archival
                        setTimeout(() => {
                            refreshData();
                        }, 1000);
                    } else {
                        button.textContent = 'âŒ Error';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    button.textContent = 'âŒ Error';
                })
                .finally(() => {
                    setTimeout(() => {
                        button.textContent = 'ðŸ”„ Trigger Archival';
                        button.disabled = false;
                    }, 2000);
                });
        }
        
        // Load data on page load
        refreshData();
    </script>
</body>
</html>
